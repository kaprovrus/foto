<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–µ–ª—Ñ–∏-–≥–æ—Å—Ç—å</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #fafafa;
      padding: 30px;
      margin: 0; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    video {
      width: 100%;
      max-width: 600px; /* –£–≤–µ–ª–∏—á–∏–ª –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –≤–∏–¥–µ–æ */
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.25); /* –£—Å–∏–ª–∏–ª —Ç–µ–Ω—å */
      background-color: #000; /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –≤–∏–¥–µ–æ, –ø–æ–∫–∞ –∫–∞–º–µ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å */
      display: block; /* –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –ø–æ–¥ –≤–∏–¥–µ–æ */
      margin-bottom: 20px; /* –û—Ç—Å—Ç—É–ø –æ—Ç –≤–∏–¥–µ–æ –¥–æ —Å—á–µ—Ç—á–∏–∫–∞/–∫–Ω–æ–ø–∫–∏ */
    }
    #counter {
      font-size: 28px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
      margin: 25px 0; /* –£–≤–µ–ª–∏—á–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
      color: #0056b3; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞ */
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1); /* –î–æ–±–∞–≤–∏–ª –ª–µ–≥–∫—É—é —Ç–µ–Ω—å —Ç–µ–∫—Å—Ç—É */
    }
    button {
      padding: 15px 35px; /* –£–≤–µ–ª–∏—á–∏–ª –æ—Ç—Å—Ç—É–ø—ã –∫–Ω–æ–ø–∫–∏ */
      font-size: 20px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
      background-color: #007bff; /* –Ø—Ä–∫–æ-—Å–∏–Ω—è—è –∫–Ω–æ–ø–∫–∞ */
      color: white;
      border: none;
      border-radius: 10px; /* –£–≤–µ–ª–∏—á–∏–ª —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.1s ease; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ */
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* –¢–µ–Ω—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
    }
    button:hover:enabled {
      background-color: #0056b3; /* –¢–µ–º–Ω–µ–µ —Å–∏–Ω–∏–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
      transform: translateY(-2px); /* –õ–µ–≥–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–¥–Ω—è—Ç–∏—è */
    }
    button:active:enabled {
      transform: translateY(0); /* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è */
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
      box-shadow: none; /* –£–±–∏—Ä–∞–µ–º —Ç–µ–Ω—å –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>–°–¥–µ–ª–∞–π 25 —Ñ–æ—Ç–æ üì∏</h1>

  <video id="video" autoplay playsinline></video>

  <div id="counter">–û—Å—Ç–∞–ª–æ—Å—å —Ñ–æ—Ç–æ: 25</div>

  <button id="captureBtn">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>

  <script>
    const video = document.getElementById('video');
    const captureBtn = document.getElementById('captureBtn'); // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª ID –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏
    const counter = document.getElementById('counter');
    // !!! –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ URL –ù–ê –°–í–û–ô –†–ï–ê–õ–¨–ù–´–ô GOOGLE APPS SCRIPT URL !!!
    const API_URL = 'https://script.google.com/macros/s/AKfycbzraYXgDX8VOQJToBN07jUb7BTSJReRrjZZRR-fI1rqqJQTCjOSVtNzls-snTUy7tPW/exec'; 

    let photosTaken = 0;
    const totalPhotos = 25;

    // --- –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã ---
    async function initCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 1920 }, // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å Full HD —à–∏—Ä–∏–Ω—É
            height: { ideal: 1080 } // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å Full HD –≤—ã—Å–æ—Ç—É
            // frameRate: { ideal: 30 } // –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —á–∞—Å—Ç–æ—Ç—É –∫–∞–¥—Ä–æ–≤
          }
        });
        video.srcObject = stream;
        // –û–∂–∏–¥–∞–µ–º, –ø–æ–∫–∞ –≤–∏–¥–µ–æ –Ω–∞—á–Ω–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        await new Promise(resolve => video.onloadedmetadata = resolve);
        console.log('–ö–∞–º–µ—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º:', video.videoWidth, 'x', video.videoHeight);
        captureBtn.disabled = false; // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –∫–∞–º–µ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ.');
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã:', error);
        captureBtn.disabled = true; // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ
        captureBtn.textContent = '–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
      }
    }

    // --- –§—É–Ω–∫—Ü–∏—è –∑–∞—Ö–≤–∞—Ç–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ ---
    async function captureAndUpload() {
      // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É, –ø–æ–∫–∞ –∏–¥–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞—Ö–≤–∞—Ç–∞/–∑–∞–≥—Ä—É–∑–∫–∏
      captureBtn.disabled = true;
      captureBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';

      const canvas = document.createElement('canvas');
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas —Ä–∞–≤–Ω—ã–º–∏ —Ç–µ–∫—É—â–µ–º—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—é –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');

      // –†–∏—Å—É–µ–º —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä —Å –≤–∏–¥–µ–æ –Ω–∞ canvas
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // --- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ---
      // –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å —ç—Ç–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –Ω–∞ canvas.
      // –ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω: —Å–Ω–∞—á–∞–ª–∞ drawImage, –∑–∞—Ç–µ–º filter, –∑–∞—Ç–µ–º –µ—â–µ —Ä–∞–∑ drawImage.
      // –ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å filter –î–û drawImage, –Ω–æ —Ç–æ–≥–¥–∞ filter –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫–æ –≤—Å–µ–º—É,
      // —á—Ç–æ —Ä–∏—Å—É–µ—Ç—Å—è –ø–æ—Å–ª–µ. –ó–¥–µ—Å—å –¥–µ–ª–∞–µ–º –ø–æ—Å–ª–µ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏.
      ctx.filter = 'contrast(105%) brightness(102%) saturate(105%)'; // –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç, —è—Ä–∫–æ—Å—Ç—å, –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
      ctx.filter = 'none'; // –í–∞–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

      // –ü–æ–ª—É—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64 —Å –≤—ã—Å–æ–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º JPEG
      const dataUrl = canvas.toDataURL('image/jpeg', 0.95); // 0.95 = 95% –∫–∞—á–µ—Å—Ç–≤–æ JPEG
      const base64 = dataUrl.replace(/^data:image\/jpeg;base64,/, ''); // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å

      try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º base64 —Å—Ç—Ä–æ–∫—É –Ω–∞ –≤–∞—à Google Apps Script
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: base64
        });

        if (!response.ok) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ:', response.statusText);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
        } else {
          console.log('–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
          photosTaken++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
          counter.textContent = `–û—Å—Ç–∞–ª–æ—Å—å —Ñ–æ—Ç–æ: ${totalPhotos - photosTaken}`; // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ:', error);
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
      } finally {
        // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–±—Ä–∞—Ç–Ω–æ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å
        if (photosTaken >= totalPhotos) {
          counter.textContent = '–ì–æ—Ç–æ–≤–æ! ‚úÖ –í—Å–µ —Ñ–æ—Ç–æ —Å–¥–µ–ª–∞–Ω—ã.';
          captureBtn.textContent = '–ì–æ—Ç–æ–≤–æ';
          captureBtn.disabled = true; // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ
        } else {
          captureBtn.disabled = false; // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–Ω–æ–≤–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–Ω–∏–º–∫–∞
          captureBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ';
        }
      }
    }

    // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ ---
    captureBtn.addEventListener('click', captureAndUpload);

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
    document.addEventListener('DOMContentLoaded', () => {
      initCamera();
      counter.textContent = `–û—Å—Ç–∞–ª–æ—Å—å —Ñ–æ—Ç–æ: ${totalPhotos - photosTaken}`;
      captureBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ';
      captureBtn.disabled = true; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã
    });
  </script>
</body>
</html>
